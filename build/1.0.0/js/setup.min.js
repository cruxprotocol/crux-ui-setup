"use strict";$(document).ready(function(){var e,c=new function(){var l=this;this.availableStates=["registration","customisation"],this.registration={el:$("#registration"),hide:function(){this.el.addClass("cs-hide")},show:function(){this.el.removeClass("cs-hide")}},this.customisation={el:$("#customisation"),hide:function(){this.el.addClass("cs-hide")},show:function(){this.el.removeClass("cs-hide")}},this.renderState=function(t){if(l.availableStates.includes(t)){var e=!0,a=!1,i=void 0;try{for(var s,r=l.availableStates[Symbol.iterator]();!(e=(s=r.next()).done);e=!0){var n=s.value;n===t?l[n].show():l[n].hide()}}catch(t){a=!0,i=t}finally{try{e||null==r.return||r.return()}finally{if(a)throw i}}}},this.renderApp=function(t){if(t&&t.cruxIDSubdomain)l.renderState("customisation"),p.init({cruxIDSubdomain:t.cruxIDSubdomain,walletClientName:t.walletClientName,availableCurrencies:t.availableCurrencies,publicAddressCurrencies:t.publicAddressCurrencies,allCurrencies:t.assetList&&t.clientMapping&&0<t.assetList.length&&0<Object.keys(t.clientMapping).length?function(t){var e=t.assetList,a=t.clientMapping,i=t.imageMapping,s={};for(var r in a)s[a[r]]=r;var n=[];for(var l in e){var o=e[l];if(o.assetId in s){var c={name:o.name,symbol:s[o.assetId],img:i[o.assetId]&&i[o.assetId].image};n.push(c)}}return n}(t):[]});else if(l.renderState("registration"),$(".id-status").html("@".concat(t.walletClientName,".crux")),t.suggestedCruxIDSubdomain){o.input.val(t.suggestedCruxIDSubdomain);var e=document.querySelector(".cruxpay-id__container");mdc.textField.MDCTextField.attachTo(e).foundation_.activateFocus(),h(t.suggestedCruxIDSubdomain)}t&&t.theme&&(document.documentElement.style.setProperty("--mdc-theme-secondary",t.theme),document.documentElement.style.setProperty("--mdc-theme-primary",t.theme))}},d={show:function(t,e){t.attr("disabled","true"),t.off("click",e)},hide:function(t,e){t.removeAttr("disabled","false"),t.on("click",e)}},t=document.querySelectorAll(".mdc-text-field"),a=!0,i=!1,s=void 0;try{for(var r,n=t[Symbol.iterator]();!(a=(r=n.next()).done);a=!0){var l=r.value;mdc.textField.MDCTextField.attachTo(l)}}catch(t){i=!0,s=t}finally{try{a||null==n.return||n.return()}finally{if(i)throw s}}var o={input:$("#cruxpayId"),inputParent:$(".cruxpay-id__container"),helperText:$("#cruxpay-id__helper-text"),parentContainer:$(".cruxpay-id__container").parent(),isValid:!1,displayError:function(t){this.helperText.removeClass("helper-text--success"),this.inputParent.addClass("mdc-text-field--invalid"),this.parentContainer.addClass("has-error"),this.helperText.html(t)},displaySuccess:function(t){o.inputParent.removeClass("mdc-text-field--invalid"),o.helperText.addClass("helper-text--success"),o.parentContainer.removeClass("has-error"),o.helperText.html(t)},displayHelpText:function(t){o.helperText.removeClass("helper-text--success"),o.inputParent.removeClass("mdc-text-field--invalid"),o.parentContainer.removeClass("has-error"),o.helperText.html(t)},getId:function(){return this.input.val()},validation:{hasDigit:function(t){return/[0-9]/.test(t)},hasAlphabets:function(t){return/[A-Za-z]/.test(t)},hasSpecialCharacters:function(t){return!/[~!@#$%^&*()=+,.?":{}|<>:;\[\]]/.test(t)},hasMinLength:function(t){return 4<=t.toString().length},hasMaxLength:function(t){return t.toString().length<=20},hasValidStartCharater:function(t){return!t.startsWith("_")&&!t.startsWith("-")},hasOnlyLowerCaseAlphabets:function(t){return!/[A-Z]/.test(t)}},isInputValid:function(){return this.isValid},renderValidationHelpers:function(t){this.validation.hasOnlyLowerCaseAlphabets(t)?(document.querySelector("[data-type='LOWERCASE']").classList.remove("rule--failed"),document.querySelector("[data-type='LOWERCASE']").classList.add("rule--success")):(document.querySelector("[data-type='LOWERCASE']").classList.add("rule--failed"),document.querySelector("[data-type='LOWERCASE']").classList.remove("rule--success")),this.validation.hasSpecialCharacters(t)?(document.querySelector("[data-type='SPECIAL_CHAR']").classList.remove("rule--failed"),document.querySelector("[data-type='SPECIAL_CHAR']").classList.add("rule--success")):(document.querySelector("[data-type='SPECIAL_CHAR']").classList.add("rule--failed"),document.querySelector("[data-type='SPECIAL_CHAR']").classList.remove("rule--success")),this.validation.hasMinLength(t)?(document.querySelector("[data-type='LEN_MIN']").classList.remove("rule--failed"),document.querySelector("[data-type='LEN_MIN']").classList.add("rule--success")):(document.querySelector("[data-type='LEN_MIN']").classList.add("rule--failed"),document.querySelector("[data-type='LEN_MIN']").classList.remove("rule--success")),this.validation.hasMaxLength(t)?(document.querySelector("[data-type='LEN_MAX']").classList.remove("rule--failed"),document.querySelector("[data-type='LEN_MAX']").classList.add("rule--success")):(document.querySelector("[data-type='LEN_MAX']").classList.add("rule--failed"),document.querySelector("[data-type='LEN_MAX']").classList.remove("rule--success")),this.validation.hasValidStartCharater(t)?(document.querySelector("[data-type='START_TYPE_ERROR']").classList.remove("rule--failed"),document.querySelector("[data-type='START_TYPE_ERROR']").classList.add("rule--success")):(document.querySelector("[data-type='START_TYPE_ERROR']").classList.add("rule--failed"),document.querySelector("[data-type='START_TYPE_ERROR']").classList.remove("rule--success"))},runValidations:function(t){return this.renderValidationHelpers(t),this.validation.hasAlphabets(t)?(this.isValid=!0,this.validation.hasOnlyLowerCaseAlphabets(t)?(this.isValid=!0,this.validation.hasSpecialCharacters(t)?(this.isValid=!0,this.validation.hasMinLength(t)?(this.isValid=!0,this.validation.hasMaxLength(t)?(this.isValid=!0,this.validation.hasValidStartCharater(t)?void(this.isValid=!0):(this.isValid=!1,void this.displayError("CRUX Id can not start with a special character"))):(this.isValid=!1,void this.displayError("CRUX Id can have maximum 20 characters"))):(this.isValid=!1,void this.displayError("CRUX Id should be minimum 4 characters"))):(this.isValid=!1,void this.displayError("Only - and _ special characters are allowed"))):(this.isValid=!1,void this.displayError("Only lowercase alphabets are allowed"))):(this.isValid=!1,void this.displayError("Your ID should contain alphabets"))}},u=null;function h(e){var t=window.walletInfo.subdomainRegistrar||"https://registrar.cruxpay.com";$.ajax({type:"GET",url:"".concat(t,"/status/").concat(e),headers:{"x-domain-name":window.walletInfo.walletClientName+"_crux"},success:function(){o.isValid=!1,o.displayError("".concat(e," is unavailable"))},error:function(t){404==t.status&&(o.isValid=!0,o.displaySuccess("".concat(e," is available")))}})}o.input.on("keyup",function(e){o.displayHelpText("Checking availability"),o.isValid=!1,clearTimeout(u),u=null,u=setTimeout(function(){var t=e.target.value;t&&0<t.length&&(o.runValidations(t),o.isInputValid()&&h(t))},500)});var m={input:$("#cruxpayPassword"),helperText:$("#cruxpay-password__helper-text"),inputParent:$(".cruxpay-password__container"),parentContainer:$(".cruxpay-password__container").parent(),isValid:!1,validation:{isValid:function(t){return/^[a-zA-Z0-9$@!#^&%_-]{8,50}$/.test(String(t).toLowerCase())},containsId:function(t){return t===o.input.val()},hasDigit:function(t){return/[0-9]/.test(t)},hasLowerCase:function(t){return/[a-z]/.test(t)},hasUpperCase:function(t){return/[A-Z]/.test(t)},hasSpecialCharacter:function(t){return/(?=.*[!#$%&?@"])/.test(t)}},displayError:function(t){this.helperText.removeClass("helper-text--success"),this.inputParent.addClass("mdc-text-field--invalid"),this.parentContainer.addClass("has-error"),this.helperText.html(t)},clearAllError:function(){this.helperText.addClass("helper-text--success"),this.inputParent.removeClass("mdc-text-field--invalid"),this.parentContainer.removeClass("has-error"),this.helperText.html("")},toggleValidationBlock:function(t){t?$(".validation-rules").css("opacity",1):$(".validation-rules").css("opacity",0)},setValidation:function(t,e){var a=$("#validation-".concat(t));this.isValid=e,a&&0<a.length&&(e?(a.removeClass("rule-isInvalid"),a.addClass("rule-isValid")):(a.addClass("rule-isInvalid"),a.removeClass("rule-isValid")))},getPassword:function(){return this.input.val()},runValidations:function(t){this.validation.isValid(t)?this.setValidation("charLen",!0):(this.setValidation("charLen",!1),this.displayError("Minimum length required is 8. Only following special characters !,#,$,%,&,?,@ are allowed")),this.validation.containsId(t)?(this.setValidation("sameAsId",!1),this.displayError("Password must be different from CruxPay ID")):this.setValidation("sameAsId",!0),this.validation.hasDigit(t)?this.setValidation("digit",!0):(this.setValidation("digit",!1),this.displayError("Password must be have atleast one number")),this.validation.hasLowerCase(t)?this.setValidation("lowercase",!0):(this.setValidation("lowercase",!1),this.displayError("Password must be have atleast one lowercase letter")),this.validation.hasUpperCase(t)?this.setValidation("uppercase",!0):(this.setValidation("uppercase",!1),this.displayError("Password must be have atleast one uppercase letter")),this.validation.hasSpecialCharacter(t)?(this.setValidation("specialCharater",!0),this.clearAllError()):(this.setValidation("specialCharater",!1),this.displayError("Password must be have atleast one of following special characters !,#,$,%,&,?,@ are allowed"))}};function v(){if(o.isValid){d.show($("#createId"),v);var t=o.getId();c.data={newPayIDName:t},e.cruxIDSubdomain=t,c.renderApp(e)}else o.isValid||(o.getId()&&0<o.getId().length?o.isInputValid()?o.displayError("".concat(o.getId()," is unavailable")):o.runValidations(o.getId()):o.displayError("cruxpay id is needed"))}m.input.on("keyup",function(t){m.toggleValidationBlock(!0),m.runValidations(m.getPassword())}),$("#createId").on("click",v),$("#createIdMobile").on("click",v);var p={container:$("#currencyContainer"),selectedCurCintainer:$("#selectedCurContainer"),search:$("#cruxSearchCur"),selectedRadio:"custom",radioContainer:$(".customisation__radio-select"),init:function(t){var a=this,e=t.cruxIDSubdomain,i=t.walletClientName,s=t.availableCurrencies,r=t.publicAddressCurrencies,n=t.allCurrencies;$(".cruxpayIdName").html("".concat(e,"@").concat(i,".crux"));var l=[],o=!0,c=!1,d=void 0;try{for(var u,h=n[Symbol.iterator]();!(o=(u=h.next()).done);o=!0){var m=u.value;s[m.symbol]&&(m.address=s[m.symbol],r.includes(m.symbol)?m.selected=!0:m.selected=!1,l.push(m))}}catch(t){c=!0,d=t}finally{try{o||null==h.return||h.return()}finally{if(c)throw d}}this.list=l,this.renderRadios(),this.search.on("keyup",function(t){var e=a.filter(a.list,t.target.value);a.renderCurList(e)}),this.renderCurList(this.list),this.renderSelectedCurPills(this.list)},availableRadios:[{id:"radio-selectCustom",value:"custom",name:"Custom"},{id:"radio-selectAll",value:"all",name:"All"},{id:"radio-selectPopular",value:"popular",name:"Popular"},{id:"radio-selectNone",value:"none",name:"None"}],renderCurList:function(t){var e="",a=!0,i=!1,s=void 0;try{for(var r,n=t[Symbol.iterator]();!(a=(r=n.next()).done);a=!0){var l=r.value;e+=this.renderCur(l)}}catch(t){i=!0,s=t}finally{try{a||null==n.return||n.return()}finally{if(i)throw s}}$(this.container).html(e),this.bindCheckboxEvents()},renderCur:function(t){var e=t.name,a=t.symbol,i=t.img,s=t.selected;t.address;return'\n\t\t\t<div class="customisation__currency '.concat(s?"customisation__currency--isSelected":"",' ">\n\t\t\t\t<div class="mdc-form-field">\n\t\t\t\t\t<div class="mdc-checkbox">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tdata-symbol="').concat(a,'"\n\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\tclass="mdc-checkbox__native-control"\n\t\t\t\t\t\t\tid="checkbox-').concat(a,'"\n\t\t\t\t\t\t\t').concat(s?"checked":"",'\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class="mdc-checkbox__background">\n\t\t\t\t\t\t\t<svg class="mdc-checkbox__checkmark" viewBox="0 0 24 24">\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tclass="mdc-checkbox__checkmark-path"\n\t\t\t\t\t\t\t\tfill="none"\n\t\t\t\t\t\t\t\td="M1.73,12.91 8.1,19.28 22.79,4.59"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t<div class="mdc-checkbox__mixedmark"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<label for="checkbox-').concat(a,'" class="customisation__checkbox-label">\n\t\t\t\t\t\t<div class="customisation__checkbox-label--inner">\n\t\t\t\t\t\t\t<img class="customisation__currency-logo" src="data:image/jpeg;base64,').concat(i,'" />\n\t\t\t\t\t\t\t<div class="customisation__currency-name">').concat(e,'</div>\n\t\t\t\t\t\t\t<div class="customisation__currency-symbol">').concat(a.toUpperCase(),"</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t")},renderSelectedCurPills:function(t){var e="",a=!0,i=!1,s=void 0;try{for(var r,n=t[Symbol.iterator]();!(a=(r=n.next()).done);a=!0){var l=r.value;l.selected&&(e+=this.renderSelectedPill(l))}}catch(t){i=!0,s=t}finally{try{a||null==n.return||n.return()}finally{if(i)throw s}}$(this.selectedCurCintainer).html(e),this.bindPillEvents()},renderSelectedPill:function(t){var e=t.symbol;return'\n\t\t\t\t<div class="selected-currency__pill">\n\t\t\t\t\t<strong>'.concat(e.toUpperCase(),'</strong>\n\t\t\t\t\t<i class="material-icons" data-symbol="').concat(e,'">clear</i>\n\t\t\t\t</div>\n\t\t\t')},renderRadios:function(){var t="",e=!0,a=!1,i=void 0;try{for(var s,r=this.availableRadios[Symbol.iterator]();!(e=(s=r.next()).done);e=!0){var n=s.value;t+=this.renderRadioEl(n)}}catch(t){a=!0,i=t}finally{try{e||null==r.return||r.return()}finally{if(a)throw i}}$(this.radioContainer).html(t),this.bindRadioEvents()},renderRadioEl:function(t){var e=t.id,a=t.value,i=t.name;return'\n\t\t\t\t<div class="mdc-form-field">\n\t\t\t\t\t<div class="mdc-radio mdc-custom-radio">\n\t\t\t\t\t\t<input class="mdc-radio__native-control" type="radio" id="'.concat(e,'" name="radios" value="').concat(a,'">\n\t\t\t\t\t\t<div class="mdc-radio__background">\n\t\t\t\t\t\t\t<div class="mdc-radio__outer-circle"></div>\n\t\t\t\t\t\t\t<div class="mdc-radio__inner-circle"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<label for="').concat(e,'">').concat(i,"</label>\n\t\t\t\t</div>\n\t\t\t")},filter:function(t,e){var a=e||"";try{var i=new RegExp(a,"ig");return t.filter(function(t){return t.name.match(i)||t.symbol.match(i)})}catch(t){return[]}},bindCheckboxEvents:function(){var i=this;$(".mdc-checkbox__native-control").on("click",function(t){var e=$(t.target);for(var a in i.list){i.list[a].symbol===e.data("symbol")&&(i.list[a].selected=e.is(":checked"))}$("#radio-selectCustom").prop("checked","true"),i.renderSelectedCurPills(i.list)})},bindPillEvents:function(){var i=this;$(".selected-currency__pill").on("click",function(t){var e=$(t.target);for(var a in i.list){i.list[a].symbol===e.data("symbol")&&(i.list[a].selected=!1)}$("#radio-selectCustom").prop("checked","true"),i.renderCurList(i.list),i.renderSelectedCurPills(i.list)})},bindRadioEvents:function(){var n=this;$(".mdc-radio__native-control").on("click",function(t){switch(t.target.value){case"custom":n.selectedRadio="custom";break;case"popular":var e=["btc","eth","xrp","bch","ltc"];for(var a in n.list){var i=n.list[a];e.includes(i.symbol)?n.list[a].selected=!0:n.list[a].selected=!1}n.renderCurList(n.list),n.renderSelectedCurPills(n.list),n.selectedRadio="popular";break;case"all":for(var s in n.list)n.list[s].selected=!0;n.renderCurList(n.list),n.renderSelectedCurPills(n.list),n.selectedRadio="all";break;case"none":for(var r in n.list)n.list[r].selected=!1;n.renderCurList(n.list),n.renderSelectedCurPills(n.list),n.selectedRadio="none"}});var t=$(".mdc-radio__native-control"),e=!0,a=!1,i=void 0;try{for(var s,r=t[Symbol.iterator]();!(e=(s=r.next()).done);e=!0){var l=s.value;this.selectedRadio===l.value&&l.setAttribute("checked","true")}}catch(t){a=!0,i=t}finally{try{e||null==r.return||r.return()}finally{if(a)throw i}}}};function y(t){var e=window.walletInfo.experience||"iframe";"react-native"===e?window.ReactNativeWebView.postMessage(t):"iframe"===e?window.parent.postMessage(t,"*"):window.opener.postMessage(t,"*")}function f(){d.show($("#updateCustomization"),f),d.show($("#updateCustomizationMobile"),f);var t={},e=!0,a=!1,i=void 0;try{for(var s,r=p.list[Symbol.iterator]();!(e=(s=r.next()).done);e=!0){var n=s.value;n.selected&&(t[n.symbol]=n.address)}}catch(t){a=!0,i=t}finally{try{e||null==r.return||r.return()}finally{if(a)throw i}}if(c.isExistingAccount){var l={type:"editExisting",data:{checkedCurrencies:t}};y(l=JSON.stringify(l))}else{var o={type:"createNew",data:{newCruxIDSubdomain:c.data.newPayIDName,checkedCurrencies:t}};y(o=JSON.stringify(o))}}$("#updateCustomization").on("click",f),$("#updateCustomizationMobile").on("click",f),$("#closeSetup").on("click",function(){var t={type:"close"};y(t=JSON.stringify(t))}),function t(){window.walletInfo&&window.imageMapping?((e=window.walletInfo).imageMapping=window.imageMapping,c.isExistingAccount=!!e.cruxIDSubdomain,c.renderApp(e)):setTimeout(function(){t()},500)}()});